<app-navbar></app-navbar>
<app-sidebar></app-sidebar>
<div class="content-wrapper pl-2">
  <div style="margin: 10px;">
    <form [formGroup]="FormCreaSolicitud">
      <!-- Contenedor feneral de la página -->
      <div class="my-2 ml-2 titulo text-center">
        <!--menu -->
        <h3>
          Administrador de Solicitudes
        </h3>
      </div>
      <!-- lineas de edición y bpusqueda --> 
      <div class="card border-primary" style="padding: 5px;margin-top: 10px;height: 200px;">
        <div class="form-row mt-2">

          <div class="form-group col-md-2">
            <label for="numsolicitud"># Solicitud</label>
            <input type="number" class="form-control form-control-sm" formControlName="numsolicitud">
          </div>

          <div class="form-group col-md-3">
            <label for="esticod">Estado Solicitud</label>
            <select name="esticod" class='form-control form-control-sm' formControlName='esticod'>
              <option *ngFor='let listaEstado of estadossolbods' [ngValue]='listaEstado.codestado'>
                {{ listaEstado.desestado }}
              </option>
            </select>
          </div>

          <div class="form-group col-md-3">
            <label for="prioridad">Prioridad</label>
            <select name="prioridad" class='form-control form-control-sm' formControlName='prioridad'>
              <option *ngFor="let prioridad of prioridades" [ngValue]="prioridad.codprioridad">
                {{ prioridad.desprioridad }}
              </option>
            </select>
          </div>

          <div class="form-group col-md-2">
            <label for="fecha">Fecha</label>
            <input appSelecttext type="text" placeholder="DD/MM/YYYY" id="fecha" class='form-control form-control-sm'
              [bsConfig]="bsConfig" bsDatepicker formControlName="fecha">
          </div>
         
          <div class="form-group col-md-2 align-self-end text-right">
            <button type="button" id="btnbuscar" class="btn btn-primary btn-sm button-my-styles-busqueda_01 " 
              (click)="BuscarSolicitudes()">Buscar Solicitud <i class="fas fa-search ml-1" aria-hidden="true"></i>    
            </button>
          </div>

        </div>


        <div class="form-row mt-2">
          <div class="form-group col-md-4">
            <label for="bodcodigo">Bodega Solicitante</label>
            <select name="bodcodigo" class='form-control form-control-sm' formControlName='bodcodigo'
              (change)="BuscaBodegasSuministro(FormCreaSolicitud.value.bodcodigo)">
              <option *ngFor='let listaBodegasSolictante of bodegasSolicitantes'
                [ngValue]='listaBodegasSolictante.bodcodigo'>
                {{ listaBodegasSolictante.boddescripcion }}
              </option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label for="codbodegasuministro">Bodega Suministro</label>
            <select name="codbodegasuministro" class='form-control form-control-sm'
              formControlName='codbodegasuministro'>
              <option *ngFor='let listaBodegassuministro of bodegassuministro'
                [ngValue]='listaBodegassuministro.bodcodigo'>
                {{ listaBodegassuministro.boddescripcion }}
              </option>
            </select>
          </div>
          <div class="form-group col-md-4  align-self-end text-right">
            <button type="button" id="btnevento" class="btn btn-primary btn-sm button-my-styles-busqueda_01"
              [disabled]="!btnevento" (click)="eventosSolicitud()">Eventos
            </button>
          </div>
        </div>

      </div>
    </form>
    <div class="card border-primary" style="padding: 5px;margin-top: 10px;height: 980px;">
      <div id="table" class="table-editable">
        <a class="btn-floating btn-lg purple-gradient"></a>
        <button type="button" class="btn btn-info btn-rounded btn-sm ml-2" 
          (click)="addArticuloGrilla()"  [disabled]="(activaagregar || FormCreaSolicitud.value.bodcodigo == null || FormCreaSolicitud.value.codbodegasuministro == null
          || FormCreaSolicitud.value.esticod == null || FormCreaSolicitud.value.prioridad == null || FormCreaSolicitud.value.fecha == null)" >Agregar <i
            class="fas fa-plus ml-2" aria-hidden="true"></i>
        </button>
        <button type="button" id="btnLimpiargrillamed" class="btn btn-danger text-right btn-sm ml-4 float-right"
          [disabled]="!activabtnlimpiagrill" 
          (click)="limpiarGrilla()">Limpiar grilla<i class="fas fa-brush ml-1"></i>
        </button>
        <div  class="table-responsive mt-2" style="height: 880px;">
          <table class="table table-sm table-condensed table-bordered  table-striped text-center">
            <tr class="table table-sm  table-primary table-bordered ">
              <th class="text-center">Código</th>
              <th class="text-center">Descripción</th>
              <th class="text-center">Unidad</th>
              <th class="text-center">Stock. Solicitante</th>
              <th class="text-center">Stock. Suministro</th>
              <th class="text-center">Solicitado*</th>
              <th class="text-center">Despachado</th>
              <th class="text-center">Pend. Despachar</th>
              <th class="text-center">Recepcionado</th>
              <th class="text-center">Devolución</th>              
              <th class="text-center">Eliminar</th>
              <th class="text-center">Eventos</th>
            </tr>
            <tr class="table-secondary"
              *ngFor="let registro of arregloDetalleProductoSolicitudPaginacion; let id = index">
              <td>
                <small><span>{{registro.codmei}}</span></small>
              </td>
              <td class="text-nowrap help   " tooltip="{{registro.meindescri }}"  >
                <small><span> {{registro.meindescri| slice:0:20 }}</span></small>
              </td>
              <td class="text-nowrap help   " tooltip="{{registro.descunidadmedida }}">
                <small><span> {{registro.descunidadmedida| slice:0:10 }}</span></small>
              </td>
              <td>
                <small><span> {{registro.stockorigen}}</span></small>
              </td>
              <td>
                <small><span>{{registro.stockdestino}} </span></small>
              </td>
              <td>
                <small>
                  <input type="number" class="form-control form-control-sm text-right" min="1" max="100"
                  [(ngModel)]="registro.cantsoli"  (input)="cambio_cantidad(id, 'cantsoli',registro)"  (blur)="cambio_cantidad(id, 'cantsoli', $event)" >
                </small>
              </td>
              <td>
                <small><span>{{registro.cantdespachada}} </span></small>
              </td>
              <td>
                <small><span>{{registro.cantsoli- registro.cantdespachada}}</span></small>
              </td>
              <td>
                <small><span>{{registro.cantrecepcionado}} </span></small>
              </td>
              <td>
                <small><span>{{registro.cantdevolucion}} </span></small>
              </td>
              <td>
                <small><span><button type="button" id="btnElinaRegistro" class="btn btn-info btn-danger btn-sm ml-2"
                    (click)="ConfirmaEliminaProductoDeLaGrilla(registro,id)" [disabled]="!activabtneliminargrilla">Eliminar
                  </button></span>
                </small>
              </td>
              <td>
                <small><span><button type="button" id="btnVerEventos" class="btn btn-info btn-rounded btn-sm ml-2"
                    (click)="eventosDetalleSolicitud(registro)" [disabled]="!btnevento">Eventos
                  </button></span>
                </small>
              </td>
            </tr>
          </table>
        </div>
        <div class="row m-1">
          <pagination [boundaryLinks]="true" [directionLinks]="true" [maxSize]="8"
            [totalItems]="arregloDetalleProductoSolicitud.length" [itemsPerPage]=20 [previousText]="'Anterior'"
            [nextText]="'Siguiente'" [firstText]="'&laquo;'" [lastText]="'&raquo;'"
            (pageChanged)="pageChanged($event)">
          </pagination>
        </div>
      </div>
    </div>

    <!--  Botones de página -->
    <div class="row float-right mr-1 mt-2">
      <!--Al agregarle col-md-3 queda el espacio entre botones cuando aparece generar solicitud-->
      <div class="form-group  align-self-end" *ngIf="modelopermisos.btngrabasolicbod">
        <button type="button" id="btnguardar" [disabled]="!activabtncreasolic" class="btn mr-1 btn-primary btn-sm button-my-styles-busqueda_02"
          (click)="ConfirmaGenerarSolicitud()">GENERAR SOLICITUD
          <i class="fas fa-save"></i>
        </button>
      </div>
      <div class="form-group  align-self-end" *ngIf="modelopermisos.btnmodificasolicbod">
        <button type="button" id="btnmodificar" [disabled]="!existesolicitud"
          class="btn mr-1 btn-primary btn-sm button-my-styles-busqueda_02"
          (click)="ConfirmaModificarSolicitud()">MODIFICAR SOLICITUD
          <i class="fas fa-save"></i>
        </button>
      </div>
      <div class="form-group  align-self-end" *ngIf="modelopermisos.btnimprsolicbod">
        <button type="button" id="btnguardar" [disabled]="!btnimprsolicitud"
            class="btn mr-1 btn-primary btn-sm button-my-styles-busqueda_02" 
            (click)="onImprimir()">IMPRIMIR SOLICITUD <i class="fas fa-file-pdf ml-1"></i>
        </button>
      </div>
      <div class="form-group  align-self-end" *ngIf="modelopermisos.btneliminasolicbod">
        <button type="button" id="btneliminar" [disabled]="!existesolicitud"
          class="btn mr-1 btn-primary btn-sm button-my-styles-busqueda_02"
          (click)="ConfirmaEliminarSolicitud()">ELIMINAR SOLICITUD <i class="fas fa-trash-alt"></i>
        </button>
      </div>
      <div class="form-group  align-self-end">
        <button type="button" id="btnlimpiar" class="btn mr-1 btn-primary btn-sm button-my-styles-busqueda_02"
          (click)="limpiar()">LIMPIAR <i class="fas fa-eraser ml-1"></i>
        </button>
      </div>
      <div class="form-group  align-self-end">
        <button type="button" id="btnsalir" class="btn btn-primary btn-sm button-my-styles-busqueda_02"
          routerLink='../home'>SALIR <i class="fas fa-window-close ml-1"></i>
        </button>
      </div>
    </div>
  </div>
  <swal #alertSwal title="" text="" type="success" [showCancelButton]="false"> </swal>
  <swal #alertSwalAlert title="" text="" type="warning" [showCancelButton]="false"> </swal>
  <swal #alertSwalError title="" text="" type="error" [showCancelButton]="false"> </swal>
</div>